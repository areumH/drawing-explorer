## 데이터 분석

metadata를 분석한 결과, 데이터는 다음과 같은 `조건부 계층 구조`를 가지는 것으로 이해했다.

```
Project
 └─ drawings
     └─ disciplines
         ├─ image
         ├─ polygon (선택적)
         ├─ regions (선택적)
         │    └─ revisions
         └─ revisions
```

하나의 도면은 여러 공종으로 나뉘며, 공종에는 기본 이미지, polygon, 관심 영역(선택적), 리비전이 존재한다. 그리고 리비전은 공종 전체가 기준이거나, 관심 영역 기준일 수 있다.

이 데이터는 항상 동일한 깊이를 가지는 구조가 아니기에 UI 설계 시 어느 단계에서 어떤 데이터가 존재하는가를 명확히 정의하는 것이 중요하다고 생각했다.

## 접근 방식

### 선택 상태 정의

```typescript
export type Selection = {
  drawingId?: string | null;
  discipline?: string | null;
  region?: string | null;
  revisionVersion?: string | null;
};
```

사용자는 `도면 → 공종 → 관심 영역 → 리비전` 순서로 도면을 탐색하므로 이를 하나의 선택 상태로 정의했다.
명확한 selection 구조를 정의한 후 현재 상태에 따라 보여질 이미지를 계산하는 방식으로 접근했다.

### 레이아웃 설계

사용자가 어떤 도면을 보고 있는지 알 수 있어야 하기 때문에 아래와 같은 구조로 설계했다.

- 상단 : Breadcrumb (현재 선택 경로 표시)
- 중앙 좌측 : 도면 선택 UI (도면 / 공종 / 관심 영역 / 리비전)
- 중앙 우측 : 도면 이미지

### Polygon 표시

메타 데이터의 polygon 좌표는 이미지의 natural size 기준이었다. 하지만 실제 화면에 표시되는 이미지 크기는 원본 크기와 다를 수 있다. 이 문제를 해결하기 위해 `img.onLoad`에서 naturalWidth, naturalHeight를 상태로 저장했고, SVG의 viewBox를 해당 사이즈 기준으로 설정했다.

```typescript
<svg viewBox={`0 0 ${imageSize.width} ${imageSize.height}`} />
```

이를 통해 이미지의 스케일이 변경되어도 polygon 비율이 유지되도록 하여 좌표 기반 데이터를 안정적으로 표시했다.

## UI 설계 방식

### 선택 UI 방식

초기에는 Chip 형태의 버튼 컴포넌트를 나열하는 방식을 고려했다. 하지만 도면 선택 단계가 많고, 상위 선택에 따라 하위 선택이 달라지며 도면 이미지까지 동시에 보여야 했기 때문에 화면이 복잡해질 것이라고 판단했다.

따라서 상단에는 Breadcrumb으로 현재 경로를 명확히 표시하고, 도면 선택 UI는 Select 컴포넌트로 단계별 노출하도록 변경했다. 상위 선택이 이루어질 때만 하위 선택을 노출하도록 구현하여 UI 복잡도를 줄였다.

### 반응형 설계

- 데스크탑 : 상단 Breadcrumb, 좌측 탐색 / 우측 도면 이미지 (2-column 구조)
- 모바일 : Breadcrumb → 도면 이미지 → 도면 선택 UI 순으로 세로 배치

### Polygon 토글 버튼 추가

도면을 자세히 확인하고 싶을 경우엔 polygon이 시야에 방해가 될 수도 있을 것이라 판단하여 polygon이 존재하는 경우에만 토글 버튼을 노출하여 사용자가 도면 이미지 위에 polygon 표시 여부를 직접 선택할 수 있도록 구현했다.

### Revision UI 설계

리비전은 단순 버전 표시가 아닌 `변경 이력`이라는 성격을 가지기 때문에 버전 이름과 날짜를 함께 표시하도록 했으며, 우측의 토글 버튼을 통한 드롭다운으로 사용자가 해당 버전의 설명과 변경 사항을 빠르게 파악할 수 있도록 구현했다.

## 기술 선택

### 스타일링

빠른 스타일링과 반응형 대응이 쉬운 tailwind CSS를 사용했다. 디자인 시스템 구축이 없어도 일관성 유지가 가능하기도 하고, 빠른 구현과 구조 설계에 집중하기 위한 선택이었다.

### 상태 관리

초기에는 전역 상태 관리를 고려했으나, 현재 구조에서는 페이지 이동이 따로 없고 컴포넌트 연결이 복잡하지 않아 `useState`만으로 충분하다고 판단했다.

## 어려웠던 점 및 개선 방안

### imageTransform 미완성

현재 구현에서는 polygon 표시까지만 반영했고 imageTransform의 실제 시각적 보정은 구현하지 못했다.
더 시간이 주어진다면 rotation, scale를 반영하고 relativeTo 기준으로 좌표 변환 로직을 구현할 것 같다.

### 상태 관리

사용자의 도면 선택 상태(selection)을 URL로 동기화하여 사용자가 링크로 도면 이미지를 공유할 수 있도록 개선하고 싶다. 그리고 더 많은 기능이 추가되거나, 페이지 이동이 필요할 정도로 더 구현하게 된다면 zustand와 같은 전역 상태 라이브러리를 사용할 것 같다.
